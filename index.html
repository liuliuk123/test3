<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹è´­å•†åŸ - åå°ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .sidebar-active {
            background-color: #e0e7ff;
            border-left: 4px solid #4f46e5;
        }
        .modal {
            display: none;
        }
        .modal.show {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="bg-indigo-600 text-white shadow-lg fixed w-full z-10">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold">ğŸ›ï¸ ä¹è´­å•†åŸåå°ç®¡ç†</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span id="adminUsername">ç®¡ç†å‘˜</span>
                <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
    </nav>

    <div class="flex pt-16">
        <!-- ä¾§è¾¹æ  -->
        <aside class="w-64 bg-white h-screen fixed shadow-lg overflow-y-auto">
            <ul class="py-4">
                <li>
                    <a href="#" onclick="showSection('dashboard')" class="sidebar-link sidebar-active block px-6 py-3 hover:bg-gray-50 transition">
                        <i class="fa fa-dashboard mr-2"></i> ä»ªè¡¨ç›˜
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('products')" class="sidebar-link block px-6 py-3 hover:bg-gray-50 transition">
                        <i class="fa fa-shopping-bag mr-2"></i> å•†å“ç®¡ç†
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('orders')" class="sidebar-link block px-6 py-3 hover:bg-gray-50 transition">
                        <i class="fa fa-list-alt mr-2"></i> è®¢å•ç®¡ç†
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('users')" class="sidebar-link block px-6 py-3 hover:bg-gray-50 transition">
                        <i class="fa fa-users mr-2"></i> ç”¨æˆ·ç®¡ç†
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('categories')" class="sidebar-link block px-6 py-3 hover:bg-gray-50 transition">
                        <i class="fa fa-tags mr-2"></i> åˆ†ç±»ç®¡ç†
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('banners')" class="sidebar-link block px-6 py-3 hover:bg-gray-50 transition">
                        <i class="fa fa-image mr-2"></i> è½®æ’­å›¾ç®¡ç†
                    </a>
                </li>
            </ul>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="ml-64 flex-1 p-8">
            <!-- ä»ªè¡¨ç›˜ -->
            <div id="dashboard-section" class="section">
                <h2 class="text-2xl font-bold mb-6">æ•°æ®æ¦‚è§ˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">ç”¨æˆ·æ€»æ•°</p>
                                <p class="text-3xl font-bold text-indigo-600" id="stat-users">0</p>
                            </div>
                            <i class="fa fa-users text-4xl text-indigo-200"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">å•†å“æ€»æ•°</p>
                                <p class="text-3xl font-bold text-green-600" id="stat-products">0</p>
                            </div>
                            <i class="fa fa-shopping-bag text-4xl text-green-200"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">è®¢å•æ€»æ•°</p>
                                <p class="text-3xl font-bold text-blue-600" id="stat-orders">0</p>
                            </div>
                            <i class="fa fa-shopping-cart text-4xl text-blue-200"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">ä»Šæ—¥è®¢å•</p>
                                <p class="text-3xl font-bold text-yellow-600" id="stat-today-orders">0</p>
                            </div>
                            <i class="fa fa-calendar text-4xl text-yellow-200"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">æ€»é”€å”®é¢</p>
                                <p class="text-3xl font-bold text-red-600">Â¥<span id="stat-sales">0</span></p>
                            </div>
                            <i class="fa fa-money text-4xl text-red-200"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">å¾…å¤„ç†è®¢å•</p>
                                <p class="text-3xl font-bold text-purple-600" id="stat-pending-orders">0</p>
                            </div>
                            <i class="fa fa-clock-o text-4xl text-purple-200"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å•†å“ç®¡ç† -->
            <div id="products-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">å•†å“ç®¡ç†</h2>
                    <button onclick="showAddProductModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">
                        <i class="fa fa-plus mr-2"></i>æ·»åŠ å•†å“
                    </button>
                </div>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">å•†å“ç¼–å·</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">å•†å“åç§°</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ä»·æ ¼</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">åº“å­˜</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">é”€é‡</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">çŠ¶æ€</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody" class="divide-y divide-gray-200">
                            <!-- åŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
                <div id="products-pagination" class="mt-4 flex justify-center"></div>
            </div>

            <!-- è®¢å•ç®¡ç† -->
            <div id="orders-section" class="section hidden">
                <h2 class="text-2xl font-bold mb-6">è®¢å•ç®¡ç†</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">è®¢å•å·</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç”¨æˆ·</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">é‡‘é¢</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">çŠ¶æ€</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">åˆ›å»ºæ—¶é—´</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="orders-tbody" class="divide-y divide-gray-200">
                            <!-- åŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
                <div id="orders-pagination" class="mt-4 flex justify-center"></div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="users-section" class="section hidden">
                <h2 class="text-2xl font-bold mb-6">ç”¨æˆ·ç®¡ç†</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç”¨æˆ·å</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">é‚®ç®±</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ‰‹æœºå·</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">è§’è‰²</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">çŠ¶æ€</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody" class="divide-y divide-gray-200">
                            <!-- åŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
                <div id="users-pagination" class="mt-4 flex justify-center"></div>
            </div>

            <!-- åˆ†ç±»ç®¡ç† -->
            <div id="categories-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">åˆ†ç±»ç®¡ç†</h2>
                    <button onclick="showAddCategoryModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">
                        <i class="fa fa-plus mr-2"></i>æ·»åŠ åˆ†ç±»
                    </button>
                </div>
                <div class="bg-white rounded-lg shadow">
                    <div id="categories-list" class="p-6">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>

            <!-- è½®æ’­å›¾ç®¡ç† -->
            <div id="banners-section" class="section hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">è½®æ’­å›¾ç®¡ç†</h2>
                    <button onclick="showAddBannerModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">
                        <i class="fa fa-plus mr-2"></i>æ·»åŠ è½®æ’­å›¾
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="banners-grid">
                    <!-- åŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </main>
    </div>

    <!-- æ·»åŠ å•†å“æ¨¡æ€æ¡† -->
    <div id="product-modal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">æ·»åŠ å•†å“</h3>
            <form id="product-form" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">å•†å“ç¼–å·*</label>
                        <input type="text" name="product_id" required class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">å•†å“åç§°*</label>
                        <input type="text" name="name" required class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">ä»·æ ¼*</label>
                        <input type="number" step="0.01" name="price" required class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">åŸä»·</label>
                        <input type="number" step="0.01" name="original_price" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">åº“å­˜</label>
                        <input type="number" name="stock" value="0" class="w-full border rounded px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">åˆ†ç±»</label>
                        <select name="category_id" class="w-full border rounded px-3 py-2" id="product-category-select">
                            <option value="">è¯·é€‰æ‹©</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">å•†å“æè¿°</label>
                    <textarea name="description" rows="3" class="w-full border rounded px-3 py-2"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">å•†å“å›¾ç‰‡URL</label>
                    <input type="text" name="image" class="w-full border rounded px-3 py-2" placeholder="https://...">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeProductModal()" class="px-4 py-2 border rounded hover:bg-gray-50">å–æ¶ˆ</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let authToken = localStorage.getItem('admin_token');

        // APIè¯·æ±‚å°è£…
        async function apiRequest(url, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(authToken && { 'Authorization': `Bearer ${authToken}` })
                }
            };

            const response = await fetch(`${API_BASE}${url}`, {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            });

            const data = await response.json();
            
            if (!response.ok) {
                if (response.status === 401) {
                    alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                    logout();
                }
                throw new Error(data.message || 'è¯·æ±‚å¤±è´¥');
            }

            return data;
        }

        // æ˜¾ç¤ºç« èŠ‚
        function showSection(section) {
            document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`${section}-section`).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('sidebar-active'));
            event.target.closest('a').classList.add('sidebar-active');

            // åŠ è½½å¯¹åº”æ•°æ®
            switch(section) {
                case 'dashboard':
                    loadDashboardStats();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'categories':
                    loadCategories();
                    break;
                case 'banners':
                    loadBanners();
                    break;
            }
        }

        // åŠ è½½ä»ªè¡¨ç›˜ç»Ÿè®¡
        async function loadDashboardStats() {
            try {
                const { data } = await apiRequest('/admin/dashboard/stats');
                document.getElementById('stat-users').textContent = data.userCount;
                document.getElementById('stat-products').textContent = data.productCount;
                document.getElementById('stat-orders').textContent = data.orderCount;
                document.getElementById('stat-today-orders').textContent = data.todayOrderCount;
                document.getElementById('stat-sales').textContent = data.totalSales;
                document.getElementById('stat-pending-orders').textContent = data.pendingOrderCount;
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½å•†å“åˆ—è¡¨
        async function loadProducts(page = 1) {
            try {
                const { data } = await apiRequest(`/products?page=${page}&limit=10`);
                const tbody = document.getElementById('products-tbody');
                tbody.innerHTML = '';

                data.products.forEach(product => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-6 py-4">${product.product_id}</td>
                        <td class="px-6 py-4">${product.name}</td>
                        <td class="px-6 py-4">Â¥${product.price}</td>
                        <td class="px-6 py-4">${product.stock}</td>
                        <td class="px-6 py-4">${product.sales}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded ${product.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${product.status === 'active' ? 'ä¸Šæ¶' : 'ä¸‹æ¶'}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800">åˆ é™¤</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('åŠ è½½å•†å“å¤±è´¥:', error);
            }
        }

        // åŠ è½½è®¢å•åˆ—è¡¨
        async function loadOrders(page = 1) {
            try {
                const { data } = await apiRequest(`/admin/orders?page=${page}&limit=10`);
                const tbody = document.getElementById('orders-tbody');
                tbody.innerHTML = '';

                const statusMap = {
                    'pending': { text: 'å¾…æ”¯ä»˜', class: 'bg-yellow-100 text-yellow-800' },
                    'paid': { text: 'å·²æ”¯ä»˜', class: 'bg-blue-100 text-blue-800' },
                    'shipped': { text: 'å·²å‘è´§', class: 'bg-purple-100 text-purple-800' },
                    'completed': { text: 'å·²å®Œæˆ', class: 'bg-green-100 text-green-800' },
                    'cancelled': { text: 'å·²å–æ¶ˆ', class: 'bg-red-100 text-red-800' }
                };

                data.orders.forEach(order => {
                    const status = statusMap[order.status] || { text: order.status, class: '' };
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-6 py-4">${order.order_no}</td>
                        <td class="px-6 py-4">${order.username}</td>
                        <td class="px-6 py-4">Â¥${order.total_amount}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded ${status.class}">${status.text}</span>
                        </td>
                        <td class="px-6 py-4">${new Date(order.created_at).toLocaleString('zh-CN')}</td>
                        <td class="px-6 py-4">
                            <select onchange="updateOrderStatus(${order.id}, this.value)" class="border rounded px-2 py-1 text-sm">
                                <option value="">æ›´æ–°çŠ¶æ€</option>
                                <option value="paid">æ ‡è®°å·²æ”¯ä»˜</option>
                                <option value="shipped">æ ‡è®°å·²å‘è´§</option>
                                <option value="completed">æ ‡è®°å·²å®Œæˆ</option>
                                <option value="cancelled">å–æ¶ˆè®¢å•</option>
                            </select>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('åŠ è½½è®¢å•å¤±è´¥:', error);
            }
        }

        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        async function loadUsers(page = 1) {
            try {
                const { data } = await apiRequest(`/admin/users?page=${page}&limit=10`);
                const tbody = document.getElementById('users-tbody');
                tbody.innerHTML = '';

                data.users.forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-6 py-4">${user.id}</td>
                        <td class="px-6 py-4">${user.username}</td>
                        <td class="px-6 py-4">${user.email || '-'}</td>
                        <td class="px-6 py-4">${user.phone || '-'}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                                ${user.role === 'admin' ? 'ç®¡ç†å‘˜' : 'ç”¨æˆ·'}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs rounded ${user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${user.status === 'active' ? 'æ­£å¸¸' : 'ç¦ç”¨'}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <button onclick="toggleUserStatus(${user.id}, '${user.status}')" class="text-indigo-600 hover:text-indigo-800">
                                ${user.status === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨'}
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥:', error);
            }
        }

        // åŠ è½½åˆ†ç±»åˆ—è¡¨
        async function loadCategories() {
            try {
                const { data } = await apiRequest('/categories');
                const list = document.getElementById('categories-list');
                list.innerHTML = '';

                data.forEach(category => {
                    const div = document.createElement('div');
                    div.className = 'border-b py-3 flex justify-between items-center';
                    div.innerHTML = `
                        <div>
                            <h4 class="font-medium">${category.name}</h4>
                            <p class="text-sm text-gray-600">${category.description || ''}</p>
                        </div>
                        <button onclick="deleteCategory(${category.id})" class="text-red-600 hover:text-red-800">åˆ é™¤</button>
                    `;
                    list.appendChild(div);
                });

                // åŒæ—¶æ›´æ–°å•†å“è¡¨å•ä¸­çš„åˆ†ç±»é€‰æ‹©
                const select = document.getElementById('product-category-select');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©</option>';
                data.forEach(cat => {
                    select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                });
            } catch (error) {
                console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
            }
        }

        // åŠ è½½è½®æ’­å›¾åˆ—è¡¨
        async function loadBanners() {
            try {
                const { data } = await apiRequest('/admin/banners');
                const grid = document.getElementById('banners-grid');
                grid.innerHTML = '';

                data.forEach(banner => {
                    const div = document.createElement('div');
                    div.className = 'bg-white rounded-lg shadow overflow-hidden';
                    div.innerHTML = `
                        <img src="${banner.image}" alt="${banner.title}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h4 class="font-medium mb-2">${banner.title || 'æ— æ ‡é¢˜'}</h4>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">æ’åº: ${banner.sort_order}</span>
                                <button onclick="deleteBanner(${banner.id})" class="text-red-600 hover:text-red-800 text-sm">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                    grid.appendChild(div);
                });
            } catch (error) {
                console.error('åŠ è½½è½®æ’­å›¾å¤±è´¥:', error);
            }
        }

        // æ¨¡æ€æ¡†æ“ä½œ
        function showAddProductModal() {
            document.getElementById('product-modal').classList.add('show');
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('show');
            document.getElementById('product-form').reset();
        }

        // æ·»åŠ å•†å“
        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                await apiRequest('/admin/products/add', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                alert('å•†å“æ·»åŠ æˆåŠŸ');
                closeProductModal();
                loadProducts();
            } catch (error) {
                alert('æ·»åŠ å¤±è´¥: ' + error.message);
            }
        });

        // åˆ é™¤å•†å“
        async function deleteProduct(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) return;
            
            try {
                await apiRequest(`/admin/products/delete/${id}`, { method: 'DELETE' });
                alert('åˆ é™¤æˆåŠŸ');
                loadProducts();
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°è®¢å•çŠ¶æ€
        async function updateOrderStatus(id, status) {
            if (!status) return;
            
            try {
                await apiRequest(`/admin/orders/status/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status })
                });
                alert('è®¢å•çŠ¶æ€å·²æ›´æ–°');
                loadOrders();
            } catch (error) {
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }

        // åˆ‡æ¢ç”¨æˆ·çŠ¶æ€
        async function toggleUserStatus(id, currentStatus) {
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            
            try {
                await apiRequest(`/admin/users/status/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: newStatus })
                });
                alert('ç”¨æˆ·çŠ¶æ€å·²æ›´æ–°');
                loadUsers();
            } catch (error) {
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }

        // ç®€åŒ–çš„æ·»åŠ åŠŸèƒ½
        function showAddCategoryModal() {
            const name = prompt('è¯·è¾“å…¥åˆ†ç±»åç§°:');
            if (!name) return;
            
            const description = prompt('è¯·è¾“å…¥åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰:');
            
            apiRequest('/admin/categories/add', {
                method: 'POST',
                body: JSON.stringify({ name, description })
            }).then(() => {
                alert('æ·»åŠ æˆåŠŸ');
                loadCategories();
            }).catch(err => alert('æ·»åŠ å¤±è´¥: ' + err.message));
        }

        function showAddBannerModal() {
            const image = prompt('è¯·è¾“å…¥è½®æ’­å›¾URL:');
            if (!image) return;
            
            const title = prompt('è¯·è¾“å…¥æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰:');
            
            apiRequest('/admin/banners/add', {
                method: 'POST',
                body: JSON.stringify({ image, title })
            }).then(() => {
                alert('æ·»åŠ æˆåŠŸ');
                loadBanners();
            }).catch(err => alert('æ·»åŠ å¤±è´¥: ' + err.message));
        }

        async function deleteCategory(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»å—ï¼Ÿ')) return;
            
            try {
                await apiRequest(`/admin/categories/delete/${id}`, { method: 'DELETE' });
                alert('åˆ é™¤æˆåŠŸ');
                loadCategories();
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        async function deleteBanner(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè½®æ’­å›¾å—ï¼Ÿ')) return;
            
            try {
                await apiRequest(`/admin/banners/delete/${id}`, { method: 'DELETE' });
                alert('åˆ é™¤æˆåŠŸ');
                loadBanners();
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // ç™»å‡º
        function logout() {
            localStorage.removeItem('admin_token');
            window.location.href = 'admin-login.html';
        }

        // åˆå§‹åŒ–
        if (!authToken) {
            window.location.href = 'admin-login.html';
        } else {
            loadDashboardStats();
            loadCategories(); // é¢„åŠ è½½åˆ†ç±»ç”¨äºå•†å“è¡¨å•
        }
    </script>
</body>
</html>

